{% extends 'base.html' %}
{% load humanize %}

{% block title %}Patient Complaints - ClinicMS{% endblock %}

{% block content %}
<!-- Page Content -->
<div class="flex-1 overflow-y-auto bg-gray-50 p-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <div>
            <h2 class="text-2xl font-semibold text-gray-800">Patient Complaints</h2>
            <p class="text-sm text-gray-500 mt-1">Manage and resolve patient complaints and feedback</p>
        </div>
        <div class="mt-4 md:mt-0 flex space-x-3">
            <div class="relative">
                <select class="appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option>All Status</option>
                    <option>Open</option>
                    <option>In Progress</option>
                    <option>Resolved</option>
                    <option>Closed</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            </div>
            <div class="relative">
                <select class="appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option>All Types</option>
                    <option>Service Quality</option>
                    <option>Billing Issues</option>
                    <option>Staff Behavior</option>
                    <option>Wait Times</option>
                    <option>Facility Issues</option>
                    <option>Other</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <i class="fas fa-tag text-xs"></i>
                </div>
            </div>
            <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center">
                <i class="fas fa-plus mr-2"></i> New Complaint
            </button>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <!-- Total Complaints -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-exclamation-circle text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Total Complaints</p>
                    <p class="text-2xl font-semibold text-gray-800">{{ total_complaints|intcomma }}</p>
                    <p class="text-xs text-gray-500 mt-1">All time</p>
                </div>
            </div>
        </div>

        <!-- Open Complaints -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                    <i class="fas fa-clock text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Open</p>
                    <p class="text-2xl font-semibold text-gray-800">{{ open_complaints|intcomma }}</p>
                    <p class="text-xs text-yellow-600 mt-1">Requires attention</p>
                </div>
            </div>
        </div>

        <!-- In Progress -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-spinner text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">In Progress</p>
                    <p class="text-2xl font-semibold text-gray-800">{{ in_progress_complaints|intcomma }}</p>
                    <p class="text-xs text-blue-600 mt-1">Being addressed</p>
                </div>
            </div>
        </div>

        <!-- Resolved -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                    <i class="fas fa-check-circle text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Resolved</p>
                    <p class="text-2xl font-semibold text-gray-800">{{ resolved_complaints|intcomma }}</p>
                    <p class="text-xs text-green-600 mt-1">This month</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Complaint Types Chart -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow p-6 lg:col-span-2">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Complaints by Type</h3>
                <select class="text-sm border-gray-300 rounded-md focus:border-blue-500 focus:ring-blue-500">
                    <option>Last 30 Days</option>
                    <option>This Month</option>
                    <option>Last Month</option>
                    <option>This Year</option>
                </select>
            </div>
            <div class="h-64">
                <canvas id="complaintTypesChart"></canvas>
            </div>
        </div>

        <!-- Status Distribution -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Status Distribution</h3>
            </div>
            <div class="h-64">
                <canvas id="statusDistributionChart"></canvas>
            </div>
            <div class="mt-4 space-y-2">
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span>
                        <span>Open</span>
                    </div>
                    <span class="font-medium">{{ open_percentage }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>
                        <span>In Progress</span>
                    </div>
                    <span class="font-medium">{{ in_progress_percentage }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>
                        <span>Resolved</span>
                    </div>
                    <span class="font-medium">{{ resolved_percentage }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-gray-300 mr-2"></span>
                        <span>Closed</span>
                    </div>
                    <span class="font-medium">{{ closed_percentage }}%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Complaints List -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="p-4 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center">
            <h3 class="text-lg font-medium text-gray-900 mb-2 sm:mb-0">Recent Complaints</h3>
            <div class="w-full sm:w-auto flex space-x-2">
                <div class="relative flex-1 sm:w-64">
                    <input type="text" placeholder="Search complaints..." class="pl-8 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full text-sm">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <button class="px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    <i class="fas fa-filter"></i>
                </button>
                <button class="px-3 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
        
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for complaint in complaints %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#{{ complaint.id }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">{{ complaint.patient_name }}</div>
                                    <div class="text-xs text-gray-500">{{ complaint.patient_id }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                {% if complaint.type == 'Service Quality' %}
                                    bg-purple-100 text-purple-800
                                {% elif complaint.type == 'Billing Issues' %}
                                    bg-red-100 text-red-800
                                {% elif complaint.type == 'Staff Behavior' %}
                                    bg-yellow-100 text-yellow-800
                                {% elif complaint.type == 'Wait Times' %}
                                    bg-blue-100 text-blue-800
                                {% else %}
                                    bg-gray-100 text-gray-800
                                {% endif %}
                                ">
                                {{ complaint.type }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-900 font-medium">{{ complaint.subject }}</div>
                            <div class="text-xs text-gray-500 line-clamp-1">{{ complaint.description|truncatechars:50 }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                {% if complaint.status == 'Open' %}
                                    bg-yellow-100 text-yellow-800
                                {% elif complaint.status == 'In Progress' %}
                                    bg-blue-100 text-blue-800
                                {% elif complaint.status == 'Resolved' %}
                                    bg-green-100 text-green-800
                                {% else %}
                                    bg-gray-100 text-gray-800
                                {% endif %}
                                ">
                                {{ complaint.status }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ complaint.created_at|date:"M d, Y" }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-3" @click="viewComplaint({{ complaint.id }})">
                                <i class="far fa-eye"></i>
                            </button>
                            <button class="text-gray-600 hover:text-gray-900">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            <div class="flex flex-col items-center justify-center">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mb-3">
                                    <i class="fas fa-inbox text-2xl"></i>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900">No complaints found</h4>
                                <p class="text-sm text-gray-500 mt-1">All patient feedback has been addressed.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if complaints %}
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="flex-1 flex justify-between sm:hidden">
                <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    Previous
                </a>
                <a href="#" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    Next
                </a>
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing
                        <span class="font-medium">1</span>
                        to
                        <span class="font-medium">10</span>
                        of
                        <span class="font-medium">{{ total_complaints }}</span>
                        results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        <a href="#" aria-current="page" class="z-10 bg-blue-50 border-blue-500 text-blue-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                            1
                        </a>
                        <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                            2
                        </a>
                        <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                            3
                        </a>
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                            ...
                        </span>
                        <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                            8
                        </a>
                        <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Complaint Detail Modal -->
<div class="fixed z-10 inset-0 overflow-y-auto hidden" id="complaintModal">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                    Complaint #<span id="complaintId"></span>
                                </h3>
                                <p class="text-sm text-gray-500 mt-1">
                                    Submitted on <span id="complaintDate"></span>
                                </p>
                            </div>
                            <div class="flex space-x-2">
                                <span id="complaintStatus" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                    
                                </span>
                                <button class="text-gray-400 hover:text-gray-500">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-medium text-gray-500">PATIENT</h4>
                                <div class="mt-1 flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900" id="patientName"></p>
                                        <p class="text-xs text-gray-500" id="patientInfo"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-sm font-medium text-gray-500">COMPLAINT TYPE</h4>
                                <p class="mt-1 text-sm text-gray-900" id="complaintType"></p>
                            </div>
                            
                            <div class="md:col-span-2">
                                <h4 class="text-sm font-medium text-gray-500">SUBJECT</h4>
                                <p class="mt-1 text-sm font-medium text-gray-900" id="complaintSubject"></p>
                            </div>
                            
                            <div class="md:col-span-2">
                                <h4 class="text-sm font-medium text-gray-500">DETAILS</h4>
                                <div class="mt-1 p-3 bg-gray-50 rounded-md">
                                    <p class="text-sm text-gray-700" id="complaintDetails"></p>
                                </div>
                            </div>
                            
                            <div class="md:col-span-2">
                                <h4 class="text-sm font-medium text-gray-500">ATTACHMENTS</h4>
                                <div class="mt-1 flex space-x-2">
                                    <div class="flex items-center px-3 py-2 border border-gray-200 rounded-md bg-gray-50">
                                        <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                                        <span class="text-xs text-gray-600">receipt.pdf</span>
                                    </div>
                                    <div class="flex items-center px-3 py-2 border border-gray-200 rounded-md bg-gray-50">
                                        <i class="fas fa-image text-blue-500 mr-2"></i>
                                        <span class="text-xs text-gray-600">photo1.jpg</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Response Section -->
                        <div class="mt-8">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">RESPONSE</h4>
                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                                <div class="flex justify-between items-start">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                            <i class="fas fa-user-md text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-blue-800">Dr. Sarah Johnson</p>
                                            <p class="text-xs text-blue-600">Clinic Manager</p>
                                        </div>
                                    </div>
                                    <span class="text-xs text-blue-500">Today, 10:30 AM</span>
                                </div>
                                <div class="mt-3 text-sm text-blue-700 bg-white p-3 rounded border border-blue-100">
                                    <p>Thank you for bringing this to our attention. We sincerely apologize for the inconvenience you've experienced. I've personally reviewed your complaint and will ensure this is addressed immediately with our staff. A member of our team will contact you within 24 hours to discuss this matter further and provide a resolution.</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <label for="response" class="block text-sm font-medium text-gray-700">Add Response</label>
                                <div class="mt-1">
                                    <textarea id="response" name="response" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Type your response here..."></textarea>
                                </div>
                                <div class="mt-2 flex justify-between">
                                    <div class="flex space-x-2">
                                        <button type="button" class="p-2 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100">
                                            <i class="far fa-paperclip"></i>
                                            <span class="sr-only">Attach file</span>
                                        </button>
                                        <button type="button" class="p-2 rounded-full text-gray-400 hover:text-gray-500 hover:bg-gray-100">
                                            <i class="far fa-smile"></i>
                                            <span class="sr-only">Add emoji</span>
                                        </button>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            Save as Draft
                                        </button>
                                        <button type="button" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            Send Response
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Update Status
                </button>
                <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Assign to
                </button>
                <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Add Note
                </button>
                <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-red-600 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Delete
                </button>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Charts
    document.addEventListener('DOMContentLoaded', function() {
        // Complaint Types Chart
        const typesCtx = document.getElementById('complaintTypesChart').getContext('2d');
        const typesChart = new Chart(typesCtx, {
            type: 'bar',
            data: {
                labels: ['Service Quality', 'Billing Issues', 'Staff Behavior', 'Wait Times', 'Facility', 'Other'],
                datasets: [{
                    label: 'Number of Complaints',
                    data: [12, 19, 8, 5, 3, 2],
                    backgroundColor: [
                        'rgba(147, 51, 234, 0.7)',
                        'rgba(239, 68, 68, 0.7)',
                        'rgba(234, 179, 8, 0.7)',
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(156, 163, 175, 0.7)'
                    ],
                    borderColor: [
                        'rgba(147, 51, 234, 1)',
                        'rgba(239, 68, 68, 1)',
                        'rgba(234, 179, 8, 1)',
                        'rgba(59, 130, 246, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(156, 163, 175, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Status Distribution Chart
        const statusCtx = document.getElementById('statusDistributionChart').getContext('2d');
        const statusChart = new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Open', 'In Progress', 'Resolved', 'Closed'],
                datasets: [{
                    data: [15, 10, 8, 5],
                    backgroundColor: [
                        'rgba(234, 179, 8, 0.7)',
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(156, 163, 175, 0.7)'
                    ],
                    borderColor: [
                        'rgba(234, 179, 8, 1)',
                        'rgba(59, 130, 246, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(156, 163, 175, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    });

    // Modal functionality
    function viewComplaint(complaintId) {
        // In a real app, you would fetch the complaint data via AJAX
        // For demo purposes, we'll use sample data
        const sampleData = {
            id: complaintId,
            date: 'November 6, 2023',
            status: 'In Progress',
            patientName: 'John Smith',
            patientInfo: 'ID: PAT-00123 | 45 years old',
            type: 'Billing Issues',
            subject: 'Incorrect billing amount for recent visit',
            details: 'I was charged $250 for my visit on October 15th, but the insurance should have covered the entire amount. I already met my deductible this year. I've tried calling the billing department but haven't received a call back yet. This is the second time this has happened and I would like this resolved as soon as possible.'
        };

        // Update modal with data
        document.getElementById('complaintId').textContent = sampleData.id;
        document.getElementById('complaintDate').textContent = sampleData.date;
        document.getElementById('patientName').textContent = sampleData.patientName;
        document.getElementById('patientInfo').textContent = sampleData.patientInfo;
        document.getElementById('complaintType').textContent = sampleData.type;
        document.getElementById('complaintSubject').textContent = sampleData.subject;
        document.getElementById('complaintDetails').textContent = sampleData.details;
        
        // Update status badge
        const statusBadge = document.getElementById('complaintStatus');
        statusBadge.textContent = sampleData.status;
        statusBadge.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full';
        
        if (sampleData.status === 'Open') {
            statusBadge.classList.add('bg-yellow-100', 'text-yellow-800');
        } else if (sampleData.status === 'In Progress') {
            statusBadge.classList.add('bg-blue-100', 'text-blue-800');
        } else if (sampleData.status === 'Resolved') {
            statusBadge.classList.add('bg-green-100', 'text-green-800');
        } else {
            statusBadge.classList.add('bg-gray-100', 'text-gray-800');
        }

        // Show modal
        document.getElementById('complaintModal').classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
    }

    // Close modal
    const modal = document.getElementById('complaintModal');
    const closeButtons = document.querySelectorAll('button:contains("Close"), .modal-close');
    
    if (modal) {
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        });
        
        // Close when clicking the X button
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                modal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        });
    }
    
    // Close button functionality
    closeButtons.forEach(button => {
        button.addEventListener('click', () => {
            modal.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        });
    });
</script>
{% endblock %}
{% endblock %}
