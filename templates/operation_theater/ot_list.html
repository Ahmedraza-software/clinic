{% extends 'operation_theater/base_ot.html' %}

{% block page_title %}{% endblock %}

{% block page_actions %}
    <a href="{% url 'operation_theater:ot_add' %}" class="btn btn-sm btn-primary">
        <i class="fas fa-plus me-1"></i> Add Operation Theater
    </a>
{% endblock %}

{% block content %}
<style>
.ot-list-container {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    max-width: 1200px;
    margin: 0 auto;
}
.ot-card {
    background: #fff;
    border: 1.5px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.2s;
}
.ot-card:hover {
    border-color: #d1d5db;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.ot-card-content {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
}
.ot-avatar {
    width: 42px;
    height: 42px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    flex-shrink: 0;
}
.ot-name {
    font-weight: 600;
    font-size: 0.9375rem;
    color: #111827;
    margin: 0;
}
.ot-id {
    font-size: 0.75rem;
    color: #9ca3af;
}
.ot-info-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}
.ot-info-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}
.ot-info-label {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #9ca3af;
    font-weight: 600;
}
.ot-info-value {
    font-size: 0.8125rem;
    color: #374151;
}
.ot-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.1875rem 0.625rem;
    border-radius: 5px;
    font-size: 0.6875rem;
    font-weight: 600;
}
.ot-badge-success {
    background: #d1fae5;
    color: #065f46;
}
.ot-badge-danger {
    background: #fee2e2;
    color: #991b1b;
}
.ot-badge-info {
    background: #dbeafe;
    color: #1e40af;
}
.ot-actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}
.ot-btn {
    padding: 0.4375rem 0.875rem;
    border-radius: 6px;
    font-size: 0.8125rem;
    font-weight: 500;
    transition: all 0.2s;
    border: 1px solid;
    white-space: nowrap;
}
.ot-btn-edit {
    color: #3b82f6;
    border-color: #3b82f6;
    background: white;
}
.ot-btn-edit:hover {
    background: #3b82f6;
    color: white;
}
.ot-btn-delete {
    color: #ef4444;
    border-color: #ef4444;
    background: white;
}
.ot-btn-delete:hover {
    background: #ef4444;
    color: white;
}
.ot-empty {
    padding: 4rem 2rem;
    text-align: center;
}
.ot-empty-icon {
    font-size: 4rem;
    color: #d1d5db;
    margin-bottom: 1.5rem;
}
.ot-empty-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
}
.ot-empty-text {
    color: #6b7280;
    margin-bottom: 1.5rem;
}
</style>

<div class="ot-list-container">
    {% if operation_theaters %}
        {% for theater in operation_theaters %}
            <div class="ot-card">
                <div class="ot-card-content">
                    <!-- Avatar & Name -->
                    <div class="d-flex align-items-center gap-2">
                        <div class="ot-avatar">
                            {{ theater.name|first|upper }}
                        </div>
                        <div>
                            <div class="ot-name">{{ theater.name }}</div>
                            <div class="ot-id">ID: OT-{{ theater.id|stringformat:"04d" }}</div>
                        </div>
                    </div>
                    
                    <!-- Info Grid -->
                    <div class="ot-info-grid">
                        <div class="ot-info-item">
                            <div class="ot-info-label">Location</div>
                            <div class="ot-info-value">{{ theater.location|default:"-" }}</div>
                        </div>
                        
                        <div class="ot-info-item">
                            <div class="ot-info-label">Status</div>
                            <div>
                                <span class="ot-badge {% if theater.is_available %}ot-badge-success{% else %}ot-badge-danger{% endif %}">
                                    {% if theater.is_available %}
                                        <i class="fas fa-check-circle me-1"></i> Available
                                    {% else %}
                                        <i class="fas fa-times-circle me-1"></i> Unavailable
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="ot-info-item">
                            <div class="ot-info-label">Last Used</div>
                            <div class="ot-info-value">
                                {% with last_surgery=theater.get_last_surgery %}
                                    {% if last_surgery %}
                                        {{ last_surgery.scheduled_date|date:"M d, Y" }}
                                    {% else %}
                                        Never used
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                        
                        <div class="ot-info-item">
                            <div class="ot-info-label">Upcoming</div>
                            <div>
                                {% with upcoming_count=theater.get_upcoming_surgeries_count %}
                                    {% if upcoming_count > 0 %}
                                        <span class="ot-badge ot-badge-info">{{ upcoming_count }} scheduled</span>
                                    {% else %}
                                        <span class="ot-info-value">None</span>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="ot-actions">
                        <a href="{% url 'operation_theater:ot_edit' theater.pk %}" 
                           class="ot-btn ot-btn-edit" 
                           title="Edit">
                            <i class="fas fa-edit me-1"></i> Edit
                        </a>
                        <form action="{% url 'operation_theater:ot_delete' theater.pk %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" 
                                    class="ot-btn ot-btn-delete" 
                                    title="Delete">
                                <i class="fas fa-trash me-1"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="ot-empty">
            <div class="ot-empty-icon">
                <i class="fas fa-hospital"></i>
            </div>
            <h5 class="ot-empty-title">No Operation Theaters Found</h5>
            <p class="ot-empty-text">
                No operation theaters have been added yet. Add one to get started.
            </p>
            <a href="{% url 'operation_theater:ot_add' %}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i> Add Operation Theater
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}
